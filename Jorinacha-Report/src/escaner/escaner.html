<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escaner HD</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; background-color: #222; color: white; }
        h1 { margin-bottom: 10px; }
        
        #reader { 
            width: 100%; 
            max-width: 600px; 
            margin: 0 auto; 
            border: 1px solid #444;
            border-radius: 8px;
            overflow: hidden;
        }

        #resultado { 
            margin-top: 20px; 
            padding: 15px; 
            font-size: 1.5em; 
            width: 90%; 
            border: 2px solid #00ff99; 
            border-radius: 8px; 
            background: #333;
            color: #fff;
            text-align: center;
        }
        .info { color: #aaa; font-size: 0.9em; margin-bottom: 20px; }
    </style>
</head>
<body>

    <h1>Escaner PRO</h1>
    <p class="info">Acerca la cámara lentamente al código.</p>
    
    <div id="reader"></div>

    <input type="text" id="resultado" placeholder="Esperando código..." readonly>

    <script>
        function onScanSuccess(decodedText, decodedResult) {
            // Reproducir un sonido beep (Opcional)
            // let audio = new Audio('beep.mp3'); audio.play();

            document.getElementById('resultado').value = decodedText;
            
            // Opcional: Detener tras leer para ahorrar batería
            // html5QrcodeScanner.clear(); 
        }

        function onScanFailure(error) {
            // No hacemos nada para no saturar
        }

        // --- CONFIGURACIÓN AVANZADA ---
        let config = { 
            fps: 10, // Fotogramas por segundo
            qrbox: { width: 250, height: 150 }, // Rectángulo más ancho para códigos de barra
            aspectRatio: 1.0, 
            disableFlip: false, 
            
            // ESTO ES LO IMPORTANTE PARA CÓDIGOS PEQUEÑOS:
            videoConstraints: {
                facingMode: "environment", // Cámara trasera
                width: { min: 640, ideal: 1920, max: 3840 }, // Pedir ALTA resolución
                height: { min: 480, ideal: 1080, max: 2160 },
                focusMode: "continuous" // Intentar forzar autoenfoque
            }
        };

        let html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", config, /* verbose= */ false);
        
        html5QrcodeScanner.render(onScanSuccess, onScanFailure);
    </script>

</body>
</html>